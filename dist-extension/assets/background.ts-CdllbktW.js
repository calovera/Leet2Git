const D="modulepreload",E=function(t){return"/"+t},$={},P=function(e,n,s){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),i=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));o=Promise.allSettled(n.map(a=>{if(a=E(a),a in $)return;$[a]=!0;const l=a.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${d}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":D,l||(u.as="script"),u.crossOrigin="",u.href=a,i&&u.setAttribute("nonce",i),document.head.appendChild(u),l)return new Promise((v,C)=>{u.addEventListener("load",v),u.addEventListener("error",()=>C(new Error(`Unable to preload CSS for ${a}`)))})}))}function r(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return o.then(c=>{for(const i of c||[])i.status==="rejected"&&r(i.reason);return e().catch(r)})};async function f(t){try{return(await chrome.storage.sync.get([t]))[t]||null}catch(e){return console.error(`Failed to get ${t} from storage:`,e),null}}async function h(t,e){try{return await chrome.storage.sync.set({[t]:e}),!0}catch(n){return console.error(`Failed to set ${t} in storage:`,n),!1}}async function p(){return await f("stats")||{streak:0,lastSolveDate:"",counts:{easy:0,medium:0,hard:0},recentSolves:[]}}async function y(t){const e=await p(),n=new Date().toDateString(),s=e.lastSolveDate?new Date(e.lastSolveDate).toDateString():"";s===n||(s===new Date(Date.now()-24*60*60*1e3).toDateString()?e.streak+=1:e.streak=1),e.lastSolveDate=new Date().toISOString(),e.counts[t.difficulty.toLowerCase()]+=1,e.recentSolves=[t,...e.recentSolves.slice(0,9)],await h("stats",e)}async function g(){return await f("pending")||[]}async function w(t){const e=await g();if(e.some(s=>s.slug===t.slug&&s.language===t.language)){console.log("Solution already pending:",t.slug,t.language);return}e.push(t),await h("pending",e)}async function x(t){const n=(await g()).filter(s=>s.id!==t);await h("pending",n)}async function S(){return await f("github_auth")}async function b(){return await f("repo_config")||{owner:"",repo:"leetcode-solutions",branch:"main",private:!1,folderStructure:"difficulty",includeDescription:!0,includeTestCases:!0}}async function _(t){await h("repo_config",t)}const A=Object.freeze(Object.defineProperty({__proto__:null,addPending:w,get:f,getAuth:S,getConfig:b,getPending:g,getStats:p,removePending:x,set:h,setConfig:_,updateStats:y},Symbol.toStringTag,{value:"Module"}));async function L({token:t,owner:e,repo:n,branch:s,path:o,content:r,message:c=`Add solution: ${o}`}){try{const i=`https://api.github.com/repos/${e}/${n}/contents/${o}`;let a;try{const u=await fetch(i,{headers:{Authorization:`Bearer ${t}`,Accept:"application/vnd.github.v3+json","User-Agent":"Leet2Git-Extension"}});u.ok&&(a=(await u.json()).sha)}catch{}const l={message:c,content:btoa(unescape(encodeURIComponent(r))),branch:s};a&&(l.sha=a);const d=await fetch(i,{method:"PUT",headers:{Authorization:`Bearer ${t}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json","User-Agent":"Leet2Git-Extension"},body:JSON.stringify(l)});if(!d.ok){const u=await d.json().catch(()=>({}));throw new Error(`GitHub API error: ${d.status} - ${u.message||d.statusText}`)}return{success:!0}}catch(i){return console.error("Failed to upsert file to GitHub:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error occurred"}}}function k(t,e){const n=I(t.language),s=`${t.slug}.${n}`;switch(e.folderStructure){case"difficulty":return`${t.difficulty.toLowerCase()}/${s}`;case"topic":return`${t.difficulty.toLowerCase()}/${s}`;case"flat":default:return s}}function q(t,e){const{title:n,difficulty:s,language:o,code:r,description:c}=t;let i="";return i+=`/*
`,i+=`Problem: ${n}
`,i+=`Difficulty: ${s}
`,i+=`Language: ${o}
`,i+=`URL: https://leetcode.com/problems/${t.slug}/
`,i+=`Date: ${new Date(t.timestamp).toISOString().split("T")[0]}
`,i+=`
`,e.includeDescription&&c&&(i+=`Description:
`,i+=c.split(`
`).map(a=>` * ${a}`).join(`
`),i+=`
`),i+=` */

`,i+=r,i}function I(t){return{JavaScript:"js",TypeScript:"ts",Python:"py",Python3:"py",Java:"java","C++":"cpp",C:"c","C#":"cs",Go:"go",Rust:"rs",Swift:"swift",Kotlin:"kt",Scala:"scala",Ruby:"rb",PHP:"php"}[t]||"txt"}console.log("Leet2Git extension background script loaded");async function m(){const t=await g(),e=t.length>0?t.length.toString():"";chrome.action.setBadgeText({text:e}),chrome.action.setBadgeBackgroundColor({color:"#3B82F6"})}chrome.runtime.onInstalled.addListener(()=>{console.log("Leet2Git extension installed"),m()});chrome.runtime.onStartup.addListener(()=>{m()});chrome.webRequest.onCompleted.addListener(async t=>{var e;if(t.method==="GET"&&t.statusCode===200)try{const n=t.url.match(/\/api\/submissions\/detail\/(\d+)/);if(!n)return;const s=n[1],o=await chrome.tabs.query({url:"https://leetcode.com/*"});if(o.length===0)return;const r=o[0].id,c=await chrome.scripting.executeScript({target:{tabId:r},func:F,args:[s]});if((e=c[0])!=null&&e.result){const i=c[0].result;i.status_display==="Accepted"&&await U(i,r)}}catch(n){console.error("Error processing submission:",n)}},{urls:["https://leetcode.com/api/submissions/detail/*"]});function F(t){return fetch(`https://leetcode.com/api/submissions/detail/${t}/`).then(e=>e.json()).catch(()=>null)}chrome.runtime.onMessage.addListener((t,e,n)=>{switch(t.type){case"auth":return T(n),!0;case"push":return G(n),!0;case"getHomeData":return B(n),!0;case"solved_dom":return O(t.payload,n),!0;case"updateConfig":return H(t.payload,n),!0;default:n({error:"Unknown message type"})}});async function U(t,e){var n;try{const o=(n=(await chrome.scripting.executeScript({target:{tabId:e},func:j}))[0])==null?void 0:n.result;if(!o)return;const r={id:`${o.slug}-${t.lang}-${Date.now()}`,title:o.title,slug:o.slug,difficulty:o.difficulty,description:o.description,code:t.code,language:t.lang,timestamp:Date.now(),status:t.status_display,submissionId:t.id,runtime:t.runtime,memory:t.memory},c={id:r.id,title:r.title,slug:r.slug,language:r.language,difficulty:r.difficulty,code:r.code,timestamp:r.timestamp,description:r.description,submissionId:r.submissionId};await w(c),await y({id:r.id,title:r.title,language:r.language,difficulty:r.difficulty,timestamp:r.timestamp}),await m(),console.log("Added solution to pending:",r.title)}catch(s){console.error("Error handling accepted submission:",s)}}function j(){var t,e,n,s;try{const o=document.querySelector('[data-cy="question-title"]')||document.querySelector(".css-v3d350")||document.querySelector("h1"),r=document.querySelector("[diff]")||document.querySelector(".css-dcmtd5")||document.querySelector('[class*="difficulty"]'),c=document.querySelector('[data-track-load="description_content"]')||document.querySelector(".css-1iinkds")||document.querySelector(".content__u3I1 .question-content"),i=((t=o==null?void 0:o.textContent)==null?void 0:t.trim())||"",a=((e=window.location.pathname.split("/problems/")[1])==null?void 0:e.split("/")[0])||"";let l="Medium";if(r){const u=((n=r.textContent)==null?void 0:n.toLowerCase())||"";u.includes("easy")?l="Easy":u.includes("hard")&&(l="Hard")}const d=((s=c==null?void 0:c.textContent)==null?void 0:s.trim())||"";return{title:i,slug:a,difficulty:l,description:d}}catch(o){return console.error("Error extracting problem info:",o),null}}async function T(t){try{const e=await chrome.identity.launchWebAuthFlow({url:"https://github.com/login/oauth/authorize?client_id=your_client_id&scope=repo",interactive:!0});if(e){const n=new URL(e).searchParams.get("code");t(n?{success:!0,code:n}:{error:"No authorization code received"})}else t({error:"Authentication cancelled"})}catch(e){t({error:e instanceof Error?e.message:"Authentication failed"})}}async function G(t){try{const e=await S();if(!e||!e.token){t({error:"GitHub not connected"});return}const n=await b();if(!n.owner){t({error:"Repository owner not configured"});return}const s=await g();if(s.length===0){t({success:!0,results:[]});return}const o=[];for(const r of s)try{const c=k(r,n),i=q(r,n),a=await L({token:e.token,owner:n.owner,repo:n.repo,branch:n.branch,path:c,content:i,message:`Add solution: ${r.title}`});a.success?(await x(r.id),o.push({item:r.title,success:!0,path:c})):o.push({item:r.title,success:!1,error:a.error})}catch(c){o.push({item:r.title,success:!1,error:c instanceof Error?c.message:"Unknown error"})}await m(),t({success:!0,results:o})}catch(e){t({error:e instanceof Error?e.message:"Push failed"})}}async function B(t){try{const e=await p(),n=await g(),s=await S(),o=await b();t({success:!0,data:{stats:e,pending:n,auth:s,config:o}})}catch(e){t({error:e instanceof Error?e.message:"Failed to get home data"})}}async function O(t,e){try{if((await g()).some(r=>r.slug===t.slug&&r.language===t.language)){e({success:!0,message:"Already pending"});return}const o={id:`${t.slug}-${t.language}-${Date.now()}`,title:t.title,slug:t.slug,language:t.language,difficulty:t.difficulty,code:t.code,timestamp:Date.now(),description:t.description};await w(o),await y({id:o.id,title:o.title,language:o.language,difficulty:o.difficulty,timestamp:o.timestamp}),await m(),e({success:!0,message:"Added to pending"})}catch(n){e({error:n instanceof Error?n.message:"Failed to handle solved DOM"})}}async function H(t,e){try{const{setConfig:n}=await P(async()=>{const{setConfig:s}=await Promise.resolve().then(()=>A);return{setConfig:s}},void 0);await n(t),e({success:!0})}catch(n){e({error:n instanceof Error?n.message:"Failed to update config"})}}
