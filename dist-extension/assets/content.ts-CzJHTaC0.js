class f{constructor(){this.isLoggedIn=!1,this.username=null,this.init()}init(){this.checkLoginStatus(),this.setupMessageListener(),this.observeSubmissions()}checkLoginStatus(){var e;const r=document.querySelector('[data-cy="user-avatar"]'),s=document.querySelector(".nav-user-menu");if(r||s){this.isLoggedIn=!0;const t=document.querySelector('[data-cy="username"]')||document.querySelector(".nav-user-link")||document.querySelector(".username");t&&(this.username=((e=t.textContent)==null?void 0:e.trim())||null)}}setupMessageListener(){chrome.runtime.onMessage.addListener((r,s,e)=>{switch(r.type){case"CHECK_LOGIN_STATUS":this.checkLoginStatus(),e({connected:this.isLoggedIn,username:this.username});break;case"GET_SUBMISSIONS":return this.getRecentSubmissions().then(t=>{e(t)}).catch(t=>{e({error:t.message})}),!0;case"GET_CURRENT_PROBLEM":return this.getCurrentProblem().then(t=>{e(t)}).catch(t=>{e({error:t.message})}),!0;default:e({error:"Unknown message type"})}})}observeSubmissions(){new MutationObserver(s=>{s.forEach(e=>{e.type==="childList"&&document.querySelectorAll('[data-cy="submission-success"]').length>0&&this.handleSuccessfulSubmission()})}).observe(document.body,{childList:!0,subtree:!0})}async handleSuccessfulSubmission(){var r;try{await new Promise(e=>setTimeout(e,2e3));const s=await this.getCurrentProblem();s&&(chrome.runtime.sendMessage({type:"NEW_SUBMISSION",submission:s}),(r=(await chrome.storage.local.get(["settings"])).settings)!=null&&r.autoSync&&chrome.runtime.sendMessage({type:"SYNC_SOLUTIONS"}))}catch(s){console.error("Failed to handle submission:",s)}}async getRecentSubmissions(){var r,s,e,t;try{if(!window.location.href.includes("/submissions/"))return[];const o=[],u=document.querySelectorAll('.submission-row, [data-cy="submission-item"]');for(const n of Array.from(u).slice(0,10))try{const i=n.querySelector('.problem-title, .title-link, a[href*="/problems/"]'),a=n.querySelector(".status, .submission-status"),l=n.querySelector(".language, .submission-language"),d=n.querySelector(".timestamp, .submission-time");if(i&&a){const y=((r=i.textContent)==null?void 0:r.trim())||"",m=((s=a.textContent)==null?void 0:s.trim())||"",g=((e=l==null?void 0:l.textContent)==null?void 0:e.trim())||"Unknown";if(m==="Accepted"){const S=i.getAttribute("href")||((t=n.querySelector("a"))==null?void 0:t.getAttribute("href"));if(S){const c=await this.getSubmissionDetails(S);c&&o.push(c)}}}}catch(i){console.error("Error parsing submission row:",i)}return o}catch(o){return console.error("Failed to get recent submissions:",o),[]}}async getCurrentProblem(){var r,s,e,t;try{const o=document.querySelector('[data-cy="question-title"]')||document.querySelector(".question-title")||document.querySelector("h1");if(!o)return null;const u=((r=o.textContent)==null?void 0:r.trim())||"",n=document.querySelector("[data-difficulty]")||document.querySelector(".difficulty")||document.querySelector('[class*="difficulty"]');let i="Medium";if(n){const c=((s=n.textContent)==null?void 0:s.toLowerCase())||"";c.includes("easy")?i="Easy":c.includes("hard")&&(i="Hard")}const a=document.querySelector('[data-cy="question-content"]')||document.querySelector(".question-content")||document.querySelector(".problem-description"),l=((e=a==null?void 0:a.textContent)==null?void 0:e.trim())||"",d=document.querySelector(".monaco-editor")||document.querySelector(".CodeMirror")||document.querySelector('textarea[data-cy="code-editor"]');let y="";if(d){const c=d.querySelector("textarea");if(c)y=c.value;else{const h=d.CodeMirror;h&&(y=h.getValue())}}const m=document.querySelector('[data-cy="lang-select"]')||document.querySelector(".language-select")||document.querySelector('select[name*="language"]');let g="JavaScript";if(m){const c=m.querySelector("option:checked")||m.querySelector(".selected");c&&(g=((t=c.textContent)==null?void 0:t.trim())||"JavaScript")}const S=this.extractTestCases();return{title:u,difficulty:i,description:l,code:y,language:g,testCases:S,timestamp:new Date,status:"Accepted"}}catch(o){return console.error("Failed to get current problem:",o),null}}async getSubmissionDetails(r){try{return null}catch(s){return console.error("Failed to get submission details:",s),null}}extractTestCases(){var s,e;const r=[];try{const t=document.querySelectorAll('[data-cy="testcase"]')||document.querySelectorAll(".testcase")||document.querySelectorAll(".example");for(const o of t){const u=o.querySelector('.input, [data-cy="input"]'),n=o.querySelector('.output, [data-cy="output"]');u&&n&&r.push({input:((s=u.textContent)==null?void 0:s.trim())||"",output:((e=n.textContent)==null?void 0:e.trim())||""})}}catch(t){console.error("Failed to extract test cases:",t)}return r}}new f;
